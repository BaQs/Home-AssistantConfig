#################################################################
## Home Related
#################################################################
- id: doorbell
  alias: 'Doorbell'
  trigger:
   - platform: state
     entity_id: switch.sonnette
     to: 'on'
  action:
    - service: notify.telegram
      data:
        message: "Cameras"
        data:
          photo:
             - url: "https://hassio.ourdouille.maison{{ states.camera.foscam_camera.attributes.entity_picture }}"
               caption: "On sonne!"

- id: postmail
  alias: 'You ve got mail'
  trigger:
   - platform: state
     entity_id: binary_sensor.door_window_sensor_158d00015b5fc7
     to: 'on'
  action:
    - service: notify.telegram
      data:
        message: "Cameras"
        data:
          photo:
             - url: "https://hassio.ourdouille.maison{{ states.camera.foscam_camera.attributes.entity_picture }}"
               caption: "Du courrier!"


# TODO
# Cave Pump
# if the pump wasn't launch since 22h, we launch it.
- id: cave_pump_daily
  alias: 'Cave: Pump'
  trigger:
    platform: time
    at: '14:00:00'
  condition:
  - condition: state
    entity_id: switch.prise_cave
    state: 'off'
    for:
      hours: 20
#  condition:
#  - condition: state
#    entity_id: binary_sensor.pierre_is_home
#    state: 'on'
  action:
    service: homeassistant.turn_on
    entity_id: switch.prise_cave


# TODO

- id: '153461612241'
  alias: 'Motion: Parking space!'
  trigger:
  - entity_id: binary_sensor.foscam_c1_motion_sensor
    platform: state
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.somebody_home
        state: 'on'
  #    - condition: state
  #      entity_id: sensor.period_of_day
  #      state: 'day'
      - condition: state
        entity_id: binary_sensor.in_bed
        state: 'off'
  action:
  - data:
      data:
        photo:
        - caption: Ca bouge sur le parking !
          url: https://hassio.ourdouille.maison{{ states.camera.foscam_camera.attributes.entity_picture }}
      message: Ca bouge sur le parking !
      title: Parking
    service: notify.telegram
#  - service: tts.google_say
#    data:
#      entity_id: media_player.google_home__salon
#      message: "La place de parking vient de se libérer"


- id: electricity_monthly_report
  alias: 'Electricity: Monthly Report'
  trigger:
  - platform: template
    value_template: '{{ now().strftime("%d") == "01" }}'
# condition:
  action:
  - service: notify.telegram
    data:
      title: Electricité
      message: |
        Il est temps de déclarer la conso !
        HP: {{ '<b>{0}{1}{2}{3}{4}</b>{5}{6}{7}'.format(*states.sensor.teleinfo_hchp.state) }}
        HC: {{ '<b>{0}{1}{2}{3}{4}</b>{5}{6}{7}'.format(*states.sensor.teleinfo_hchc.state) }}
        https://clients.direct-energie.com/ma-conso/faire-mon-e-releve/
#       HP: {{ states.sensor.teleinfo_hchp.state  }}
#       HC: {{ states.sensor.teleinfo_hchc.state  }} 
#     message: Test
#  - service: tts.google_say
#    data:
#      entity_id: media_player.google_home__salon
#      message: "La place de parking vient de se libérer"

