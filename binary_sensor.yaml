  - platform: rfxtrx
    automatic_add: False
#   devices:
#            "0B1100000144449201040F60":
#                    name: BS Sonnette
#           '0b1100070144449201040f60':

  - platform: rest
    name: "Foscam C1 Motion Sensor"
    resource: !secret foscam_resource_url 
    verify_ssl: false
    device_class: motion
    scan_interval: 5
    value_template: >-
      {%- if "<motionDetectAlarm>2</motionDetectAlarm>" in value -%}
        {{ true }}
      {%- else -%}
        {{ false }}
      {%- endif -%}

  - platform: bayesian
    name: 'Pierre is Home'
    prior: 0.6
    probability_threshold: 0.80
    observations:
      - entity_id: 'device_tracker.ipierre'
        prob_given_true: 0.9
        prob_given_false: 0.2
        platform: 'state'
        to_state: 'home'
      - entity_id: 'device_tracker.ipierre_2'
        prob_given_true: 0.99
        prob_given_false: 0.6
        platform: 'state'
        to_state: 'home'
#      - entity_id: 'binary_sensor.welcam_someone_known'
#        prob_given_true: 0.7
#        prob_given_false: 0.5
#        platform: 'state'
#        to_state: 'home'
#      - entity_id: 'binary_sensor.welcam_3_someone_known'
#        prob_given_true: 0.7
#        prob_given_false: 0.5
#        platform: 'state'
#        to_state: 'home'
#      - entity_id: binary_sensor.motion_detected
#        platform: state
#        to_state: 'on'
#        prob_given_true: 0.6
#        prob_given_false: 0.01
#      # Somebody at home -> likely that at least one indoor light is turned on
#      - entity_id: group.all_lights
#        platform: state
#        to_state: 'on'
#        prob_given_true: 0.7
#
          
  - platform: bayesian
    name: In Bed
    prior: .33 # 33% chance that we are in bed (8 hrs out of 24hrs)
    probability_threshold: 0.95
    observations:
      # We are in bed -> vey likely at least one household member is at home
      - entity_id: group.household
        platform: state
        to_state: home
        prob_given_true: 0.99 # 99% chance that if we are in bed we are at home
        prob_given_false: 0.5 # 50% chance that if we are not in bed we are at home
      # we are in bed -> likely alarm will be set
#      - entity_id: alarm_control_panel.home_alarm
#        platform: state
#        to_state: armed_home
#        prob_given_true: 0.9 # 90% chance that if we are in bed alarm is armed
#        prob_given_false: 0.5 # 50% chance that if we are not in bed alarm is armed
      # we are in bed -> vey likely no motion is detected
      - entity_id: binary_sensor.motion_detected
        platform: state
        to_state: 'off'
        prob_given_true: 0.9 # 90% chance that if we are in bed no motion is detected
        prob_given_false: 0.7 # 70% chance that if we are not in bed no motion is detected
      # we are in bed -> very likely it is night time
      - entity_id: 'sensor.period_of_day'
        platform: 'state'
        to_state: 'night'
        prob_given_true: 0.9 # 90% chance that if we are in bed it is night
        prob_given_false: 0.1 # 10% chance that if we are not in bed it is night
      - entity_id: 'sensor.period_of_day'
        platform: 'state'
        to_state: 'day'
        prob_given_true: 0.1 # 10% chance that if we are in bed it is day
        prob_given_false: 0.9 # 90% chance that if we are not in bed it is day
      # we are in bed -> likely that master bedroom light is off
      - entity_id: 'group.all_lights'
        platform: 'state'
        to_state: 'off'
        prob_given_true: 0.9 # 90% chance that if we are in bed, the light is off
        prob_given_false: 0.4 # 40% chance that if we are not in bed the light is off
      - entity_id: 'binary_sensor.motion_last30'
        platform: 'state'
        to_state: 'off'
        prob_given_true: 0.9 # 90% chance that if we are in bed, no motion since 30min
        prob_given_false: 0.4 # 40% chance that if we are not in bed, no motion since 30min
      - entity_id: 'binary_sensor.motion_last10'
        platform: 'state'
        to_state: 'off'
        prob_given_true: 0.9  # 90% chance that if we are in bed, no motion since 10min
        prob_given_false: 0.5  # 50% chance that if we are not in bed, no motion since 10min
      - entity_id: remote.harmony_hub
        platform: state
        to_state: 'off'
        prob_given_true: 0.9 # 90% chance that if we are in bed, remote is off
        prob_given_false: 0.4 # 40% chance that if we are not in bed, remote is off
      - entity_id: 'sensor.ipierre_battery_state'
        prob_given_true: 0.7 # 70% chance that if we are in bed, battery is charging
        prob_given_false: 0.2 # 10% chance that if we are not in bed, battery is charging
        platform: 'state'
        to_state: 'Charging'
#
 
#  
#
#  - platform: bayesian
#    name: 'In Bed'
#    prior: 0.4
#    probability_threshold: 0.95
#    observations:
## lights are off
#      - entity_id: 'group.all_lights'
#        prob_given_true: 0.3
#        prob_given_false: 0.01
#        platform: 'state'
#        to_state: 'off'
## TV off
#      - entity_id: 'remote.harmony_hub'
#        prob_given_true: 0.4
#        prob_given_false: 0.01
#        platform: 'state'
#        to_state: 'Off'
## Somebody is home :)
#      - entity_id: 'binary_sensor.somebody_home'
#        prob_given_true: 0.6
#        prob_given_false: 0.01
#        platform: 'state'
#        to_state: 'on'
## iPhone plugged in
#      - entity_id: 'sensor.ipierre_battery_state'
#        prob_given_true: 0.7
#        prob_given_false: 0.5
#        platform: 'state'
#        to_state: 'Charging'
#      - entity_id: 'sensor.period_of_day'
#        prob_given_true: 0.8
#        platform: 'state'
#        to_state: 'night'
#      - entity_id: 'binary_sensor.motion_last30'
#        prob_given_true: 0.8
#        prob_given_false: 0.2
#        platform: 'state'
#        to_state: 'off'
#      - entity_id: 'binary_sensor.motion_last10'
#        prob_given_true: 0.7
#        prob_given_false: 0.5
#        platform: 'state'
#        to_state: 'off'
  

  - platform: bayesian
    name: Somebody home
    prior: 0.6  # 60% chance that somebody is at home at any given moment
    probability_threshold: 0.90
    observations:
      # Somebody at home -> Very likely at least one household member is at home
      - entity_id: group.household
        platform: state
        to_state: home
        prob_given_true: 0.99 # 99% chance that if we are home, household is home
        prob_given_false: 0.2 # 0.2% chance that if we are not home, household is home
      # Somebody at home -> Likely alarm is disarmed
#      - entity_id: alarm_control_panel.home_alarm
#        platform: state
#        to_state: disarmed
#        prob_given_true: 0.7 # 79% chance that if we are home, alarm is disarmed
      # Somebody at home -> likely that at least one indoor light is turned on
      - entity_id: group.all_lights
        platform: state
        to_state: 'on'
        prob_given_true: 0.6 # 50% chance that if we are home, light is on
      # Somebody at home -> Very Likely motion will be detected
      - entity_id: binary_sensor.motion_detected
        platform: state
        to_state: 'on'
        prob_given_true: 0.7 # 79% chance that if we are home, motion detected
        prob_given_false: 0.01 # 0.01 chance that if we are not home, motion detected
      - entity_id: 'binary_sensor.welcam_3_someone_known'
        prob_given_true: 0.7 # 79% chance that if we are home, somebody known
        prob_given_false: 0.01 # 1% chance that if we are not home, somebody known
        platform: 'state'
        to_state: 'on'
      - entity_id: remote.harmony_hub
        platform: state
        to_state: 'on'
        prob_given_true: 0.7 # 79% chance that if we are home, remote is on
        prob_given_false: 0.01 # 0.1% chance that if we are not home, remote is on
      # Somebody at home -> Very likely occupancy will detected
#      - entity_id: group.occupancy_sensors
#        platform: state
#        to_state: 'on'
#        prob_given_true: 0.8
#        prob_given_false: 0.01




 
  - platform: template
    sensors:
      # Is on for 5 minutes after motion detectors trigger
      motion_detected:
        friendly_name: Motion detected
        delay_off:
          minutes: 3
        entity_id:
          - group.motion_detectors
        value_template: "{{is_state('group.motion_detectors', 'on')}}"
   
  - platform: template
    sensors:
      motion_last10:
        friendly_name: Motion in Last 10min
        device_class: motion
        #value_template: '{{(  as_timestamp(strptime(states.sensor.date__time.state, "%Y-%m-%d, %H:%M"))-as_timestamp(states.binary_sensor.motion_detected.last_changed)) < 600 }}'
        #value_template: '{{(as_timestamp(now()) - as_timestamp(states.binary_sensor.motion_detected.last_changed) < 1800)}}'
        value_template: '{{(  as_timestamp(strptime(states.sensor.date__time.state, "%Y-%m-%d, %H:%M"))   - as_timestamp(states.binary_sensor.motion_detected.last_changed) < 600)}}'
  
  - platform: template
    sensors:
      motion_last30:
        friendly_name: Motion in Last 30min
        device_class: motion
        #value_template: '{{(  as_timestamp(strptime(states.sensor.date__time.state, "%Y-%m-%d, %H:%M"))-as_timestamp(states.binary_sensor.motion_detected.last_changed)) < 1800 }}'
        #value_template: '{{(as_timestamp(now()) - as_timestamp(states.binary_sensor.motion_detected.last_changed) < 1800)}}'
        value_template: '{{(  as_timestamp(strptime(states.sensor.date__time.state, "%Y-%m-%d, %H:%M"))   - as_timestamp(states.binary_sensor.motion_detected.last_changed) < 1800)}}'
  
